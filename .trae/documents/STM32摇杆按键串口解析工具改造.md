# 改造计划

## 1. 后端改造

### 1.1 串口通信模块 (`serial.rs`)
- 修改`read`函数，支持解析新的数据格式：`AA 5A 00 00 03 80 80 80 80 00 00 00 80 00 00 00 00 00 00 00 00 00 73 BF`
- 实现帧头检测、数据长度验证和校验功能
- 移除原有音频矩阵相关的命令解析

### 1.2 数据处理模块 (`matrix.rs`)
- 替换音频矩阵控制逻辑，实现新的数据解析功能
- 解析按键状态（24个按键）
- 解析14路ADC数据
- 解析LED状态（20个LED）
- 实现数据结构来存储解析结果

### 1.3 配置文件 (`config.rs`)
- 简化配置结构，移除音频矩阵相关配置
- 添加新的数据解析配置项

## 2. 前端改造

### 2.1 主界面 (`App.jsx`)
- 保留第一页的串口选择和连接功能
- 将第二页"矩阵映射"改为"数据解析"页面
- 移除不必要的功能：批量操作、模式切换、自定义名称
- 新增数据可视化组件

### 2.2 数据可视化页面
- 按键状态显示：24个按键的实时状态，按下/松开可视化
- ADC数据显示：14路ADC的实时数值，支持柱状图或数值显示
- LED状态显示：20个LED的亮灭状态
- 原始数据显示：十六进制格式的原始数据
- 数据刷新控制

### 2.3 样式和国际化
- 保留现有主题切换和语言切换功能
- 更新国际化文本，移除音频矩阵相关术语

## 3. 数据格式解析

### 3.1 数据结构
```
帧头: AA
索引号: 1字节
按键状态: 3字节 (24个按键)
ADC数据: 14字节 (14路ADC, 每路0-255)
LED状态: 3字节 (20个LED)
异或校验: 1字节
结束符: BF
```

### 3.2 解析逻辑
1. 检测帧头 `AA`
2. 验证结束符 `BF`
3. 校验数据长度
4. 计算并验证异或值
5. 解析按键状态：每一位代表一个按键
6. 解析ADC数据：直接读取14个字节
7. 解析LED状态：每一位代表一个LED

## 4. 实现步骤

1. 修改后端串口解析逻辑，支持新的数据格式
2. 实现数据解析功能，存储解析结果
3. 改造前端界面，添加数据可视化组件
4. 测试串口连接和数据解析功能
5. 优化界面布局和用户体验

## 5. 技术选型

- 后端：Rust（保留现有）
- 前端：React + Ant Design（保留现有）
- 数据可视化：使用Ant Design的组件库，结合自定义样式

## 6. 预期效果

- 能够正确连接串口，接收STM32发送的数据
- 实时解析并显示按键、ADC和LED状态
- 界面简洁直观，支持明暗主题切换
- 支持中英文语言切换

## 7. 原型图

### 主界面
- 串口选择和连接功能保持不变
- 新增数据解析页面入口

### 数据解析页面
- 顶部显示连接状态和实时数据统计
- 左侧显示24个按键的状态（按下/松开）
- 中间显示14路ADC的数值（柱状图或数值列表）
- 右侧显示20个LED的状态（亮/灭）
- 底部显示原始数据和解析信息

### 按键状态显示
- 24个按键以网格形式排列
- 按下时显示高亮颜色，松开时显示默认颜色
- 每个按键显示编号

### ADC数据显示
- 14路ADC以横向柱状图或数值列表显示
- 支持实时更新
- 显示当前值和变化趋势

### LED状态显示
- 20个LED以横向排列
- 亮时显示绿色，灭时显示灰色
- 每个LED显示编号

这个改造计划将保留原项目的核心架构，同时实现新的功能需求，确保代码的可维护性和扩展性。